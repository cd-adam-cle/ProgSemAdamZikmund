API Routes in Next.js 14

Location: app/api/[route]/route.ts

API routes allow you to create API endpoints in your Next.js application.

Basic Structure:
Create a route.ts file in the app/api directory:

app/api/hello/route.ts

HTTP Methods:
Export functions named after HTTP methods:

export async function GET(request: Request) {
  return Response.json({ message: 'Hello World' })
}

export async function POST(request: Request) {
  const body = await request.json()
  return Response.json({ success: true, data: body })
}

export async function PUT(request: Request) {
  const body = await request.json()
  // Update logic
  return Response.json({ updated: true })
}

export async function DELETE(request: Request) {
  // Delete logic
  return Response.json({ deleted: true })
}

export async function PATCH(request: Request) {
  const body = await request.json()
  // Patch logic
  return Response.json({ patched: true })
}

Using NextResponse:
Import NextResponse for more control:

import { NextResponse } from 'next/server'

export async function GET() {
  return NextResponse.json(
    { message: 'Success' },
    { status: 200 }
  )
}

Error Handling:
export async function POST(request: Request) {
  try {
    const body = await request.json()

    if (!body.email) {
      return NextResponse.json(
        { error: 'Email is required' },
        { status: 400 }
      )
    }

    // Process data
    return NextResponse.json({ success: true })

  } catch (error) {
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { status: 500 }
    )
  }
}

Request Object:
The request object provides:
- request.json() - Parse JSON body
- request.formData() - Parse form data
- request.text() - Get text body
- request.headers - Access headers
- request.cookies - Access cookies
- request.nextUrl - Get URL information

Dynamic Routes:
app/api/users/[id]/route.ts

export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  const userId = params.id
  return NextResponse.json({ userId })
}

Query Parameters:
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url)
  const query = searchParams.get('query')

  return NextResponse.json({ query })
}

Headers:
export async function GET(request: Request) {
  const token = request.headers.get('authorization')

  return NextResponse.json(
    { data: 'protected' },
    { headers: { 'X-Custom-Header': 'value' } }
  )
}

Cookies:
import { cookies } from 'next/headers'

export async function GET() {
  const cookieStore = cookies()
  const token = cookieStore.get('token')

  return NextResponse.json({ token: token?.value })
}

CORS:
export async function GET(request: Request) {
  return NextResponse.json(
    { message: 'Hello' },
    {
      headers: {
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
        'Access-Control-Allow-Headers': 'Content-Type, Authorization',
      },
    }
  )
}

Middleware Pattern:
Create reusable middleware for authentication, validation, etc:

async function withAuth(request: Request, handler: Function) {
  const token = request.headers.get('authorization')

  if (!token) {
    return NextResponse.json(
      { error: 'Unauthorized' },
      { status: 401 }
    )
  }

  return handler(request)
}

export async function GET(request: Request) {
  return withAuth(request, async (req) => {
    return NextResponse.json({ data: 'protected' })
  })
}
